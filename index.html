<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Snippet - BBBootstrap</title>
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<style>
		::-webkit-scrollbar {
			width: 8px;
		}

		/* Track */
		::-webkit-scrollbar-track {
			background: #f1f1f1;
		}

		/* Handle */
		::-webkit-scrollbar-thumb {
			background: #888;
		}

		/* Handle on hover */
		::-webkit-scrollbar-thumb:hover {
			background: #777;
		}

		body {
			background-color: #eee;

		}

		.bdge {
			height: 21px;
			background-color: orange;
			color: #fff;
			font-size: 11px;
			padding: 8px;
			border-radius: 4px;
			line-height: 3px;
		}

		.comments {
			text-decoration: underline;
			text-underline-position: under;
			cursor: pointer;
		}

		.dot {
			height: 7px;
			width: 7px;
			margin-top: 3px;
			background-color: #bbb;
			border-radius: 50%;
			display: inline-block;
		}

		.hit-voting:hover {
			color: blue;
		}

		.hit-voting {
			cursor: pointer;
		}

		.blur {
			filter: blur(5px);
			/* or any other blur effect you want */
			transition: filter 0.3s ease;
		}

		.buttons-container {
			margin-top: 12px;
			display: flex;
			align-items: center;
			vertical-align: middle;
		}

		.held-for-review-text {

			margin-left: 10px;
			padding: 5px;
			font-weight: bold;
			font-size: 14px;
			color: #333;
			border-radius: 5px;
			box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
		}

		.hate-info {
			color: #555;
			font-size: smaller;
			font-style: italic;
		}

		.toast {
			position: fixed;
			top: 20px;
			left: 50%;
			transform: translateX(-50%);
			color: #333;
			padding: 15px;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			opacity: 0;
			/* Initially invisible */
			transition: opacity 0.3s ease-in-out;
		}

		.toast.show {
			opacity: 1;
			/* Make it visible when the show class is added */
		}

		/* Styles for the disabled state */
		input:disabled {
			/* Your styles for disabled state go here */
			opacity: 0.5;
			/* Example: reduce opacity for a visually disabled effect */
			cursor: not-allowed;
			/* Example: change cursor to not-allowed */
			/* Add more styles as needed */
		}
	</style>
</head>

<body className="snippet-body">
	<div class="container mt-5 mb-5">
		<div class="d-flex justify-content-center row p-4">
			<div class="d-flex flex-column col-md-8">
				<div class="d-flex flex-row align-items-center text-left comment-top p-2 bg-white border-bottom p-4">
					<div class="profile-image"><img class="rounded-circle"
							src="https://randomuser.me/api/portraits/med/lego/8.jpg" width="70"></div>
					<div class="d-flex flex-column ml-3">
						<p><i>Content moderation powered by ShhorAI</i></p>
						<div class="d-flex flex-row post-title">
							
							<h5>Pranshu ke saath aisa nahi hona chahiye tha. It's high time ke hum social media bullying par awaaz uthaye! üåç
								#GayRights #JusticeForPranshu</h5><span class="ml-2">(@iAmQueerIamHere)</span>
						</div>
						<div class="d-flex flex-row align-items-center align-content-center post-title">
						</div>
					</div>
				</div>
				<div class="coment-bottom bg-white p-2 p-4">
					<div class="d-flex flex-row add-comment-section mt-4 mb-4"><img
							class="img-fluid img-responsive rounded-circle mr-2"
							src="https://randomuser.me/api/portraits/med/lego/6.jpg" width="38">
						<input id="commentInput" type="text" class="form-control mr-3"
							placeholder="Waiting for access validation" disabled>
						<button id="commentButton" class="btn btn-primary" type="button">Comment</button>
					</div>
					<div class="commented-section mt-2">
						<div class="d-flex flex-row align-items-center commented-user">
							<h5 class="mr-2">theQueerMuslimah</h5>
						</div>
						<div class="comment-text-sm"><span>100% sahi baat bola!!!</span></div>

					</div>
					<hr>
					<div class="commented-section mt-2">
						<div class="d-flex flex-row align-items-center commented-user">
							<h5 class="mr-2">WomanWithOpinions</h5>
						</div>
						<div class="comment-text-sm"><span>Bas 16 saal ka pyara sa ladka, bullying ke wajah se kho gaya üíîüíîüíîüíî</span></div>

					</div>
					<hr>
					<div class="commented-section mt-2">
						<div class="d-flex flex-row align-items-center commented-user">
							<h5 class="mr-2">notATrollHaha</h5>
						</div>
						<div class="comment-text-sm blur"><span>Eh chup bey chakke. Tum sabko mar jana chaiye!! Chalo ek toh kam hua. ü§¨üò°</span>
						</div>
						<span class="hate-info">This comment is hidden because it might be offensive</span>
						<div class="buttons-container"><button
								class="btn btn-outline-secondary mr-2 toggle-button">View</button>
							<button class="btn btn-danger delete-button mr-2">Delete</button>
							<a class="held-for-review-link" href="javascript:void(0)">Submit for Review</a>
						</div>
					</div>



				</div>
			</div>
		</div>
	</div>
	</div>

	<script type="text/javascript"
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
	<script type="text/javascript" src="#"></script>
	<script type="text/javascript" src="#"></script>
	<script type="text/javascript" src="#"></script>

</body>

<script>
	// Declare access_token in the global scope
	let access_token = null;

	document.addEventListener('DOMContentLoaded', function () {
		var myHeaders = new Headers();
		myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

		var urlencoded = new URLSearchParams();
		urlencoded.append("username", "tester");
		urlencoded.append("password", "tester");

		var requestOptions = {
			method: 'POST',
			headers: myHeaders,
			body: urlencoded,
			redirect: 'follow'
		};

		// Use async/await to wait for the fetch to complete
		async function fetchData() {
			try {
				const response = await fetch("https://api.shhorai.com/token", requestOptions);
				const data = await response.json();
				if (response.ok) {
					// Set the global variable access_token
					access_token = data.access_token;
					console.log("Access validated")

					// Get a reference to the input element
					var commentInput = document.getElementById("commentInput");
					commentInput.placeholder = "Add comment";
					commentInput.removeAttribute("disabled"); // Remove the "disabled" attribute

				}
				else {
					console.error("Error while validation")
				}

			} catch (error) {
				console.log('Error:', error);
			}
		}

		// Call the function to fetch data
		fetchData();
	});


</script>

</script>
<script type="text/javascript">
	function showToast(message, type = "success", timeout = 5) {
		timeout = timeout * 1000
		// Define the default class and color
		let toastClass = "toast";
		let toastColor = "#ffcccc"; // Light red background color

		// Update class and color based on the type parameter
		switch (type) {
			case "warn":
				toastColor = "#ffcccc"; // Yellow background color
				break;
			case "success":
				toastColor = "#99ff99"; // Light green background color
				break;
			case "process":
				toastColor = "#66b3ff"; // Light blue background color
				break;
			// Add more cases for other types if needed
		}

		var toast = document.createElement("div");
		toast.className = toastClass;
		toast.textContent = message;

		document.body.appendChild(toast);

		// Set the background color dynamically
		toast.style.backgroundColor = toastColor;

		// Add the show class to make the toast visible
		toast.classList.add("show");

		// Remove the toast after a certain duration (e.g., 5 seconds)
		setTimeout(() => {
			document.body.removeChild(toast);
		}, timeout);
	}

	async function checkHateSimulate(comment) {
		// Simulating an asynchronous API call with a Promise
		return new Promise((resolve, reject) => {
			// Assume your actual API call is here
			setTimeout(() => {
				const isHate = comment.toLowerCase().includes('hate');

				if (!isHate) {
					const randomValue = Math.random(); // Generate a random number between 0 and 1
					if (comment.toLowerCase().includes('held')) {
						// Simulate returning true
						resolve("review");
					} else {
						// Simulate an error
						resolve(false)
					}
				} else {
					// Comment contains hate
					resolve(true);
				}
			}, 1000); // Simulating a delay of 5 seconds
		});
	}

	async function checkHate(comment) {
		try {
			// console.log("Checking for hate")
			var myHeaders = new Headers();
			myHeaders.append("Content-Type", "application/json");
			myHeaders.append("Authorization", `Bearer ${access_token}`);

			var raw = JSON.stringify({
				"text": comment
			});

			var requestOptions = {
				method: 'POST',
				headers: myHeaders,
				body: raw,
				redirect: 'follow'
			};

			const response = await fetch("https://api.shhorai.com/prediction", requestOptions)
			if (response.ok) {
				let response_json = await response.json()
				const hate = response_json.prediction
				// console.log("hate value", hate)

				if (hate == 1) {
					return true
				}
				else {
					return false
				}
			}
			else {
				console.log("Server held for review")
				return "review"
			}



		}
		catch (e) {
			console.log("Server held for review2")
			return "review"
		}
	}

	async function addButtonsToComment(commentSection, commentText) {
		const result = await checkHate(commentText)

		if (result) {
			var textElement = commentSection.querySelector('.comment-text-sm');
			textElement.classList.add('blur');

			var hateInfo = document.createElement('span');
			hateInfo.className = 'hate-info';
			hateInfo.textContent = 'This comment is hidden because it might be offensive';
			commentSection.appendChild(hateInfo);

			// Create a container for buttons
			var buttonsContainer = document.createElement('div');
			buttonsContainer.className = 'buttons-container';

			var viewButton = document.createElement('button');
			viewButton.className = 'btn btn-outline-secondary mr-2 toggle-button';
			viewButton.textContent = 'View';
			buttonsContainer.appendChild(viewButton);

			var deleteButton = document.createElement('button');
			deleteButton.className = 'btn btn-danger delete-button mr-2';
			deleteButton.textContent = 'Delete';
			buttonsContainer.appendChild(deleteButton);

			// Check the result and handle accordingly
			if (result === 'review') {
				// Comment is held for review
				textElement.classList.add('held-for-review');

				// Display a toast for held-for-review comments
				showToast('Your comment is queued for review.', "warn");

				// Create a div for the "Held for Review" text
				var heldForReviewText = document.createElement('div');
				heldForReviewText.className = 'held-for-review-text';
				heldForReviewText.textContent = 'Queued for Review';

				// Append the "Held for Review" text to the comment section
				buttonsContainer.appendChild(heldForReviewText);
			}
			else {
				var heldForReviewLink = document.createElement('a');
				heldForReviewLink.className = 'held-for-review-link';
				heldForReviewLink.textContent = 'Submit for Review';
				heldForReviewLink.href = 'javascript:void(0)'; // Add your review submission link here

				// Append the link to the document body or a specific container
				buttonsContainer.appendChild(heldForReviewLink);

				// Display a toast for held-for-review comments
				showToast('Your comment is classified as hate, it will be blurred for other users, we recommend you to delete it', "warn");
			}

			// Append the buttons container to the comment section
			commentSection.appendChild(buttonsContainer);
		}
	}

	function submitComment() {
		var commentInput = document.getElementById('commentInput');
		var newComment = commentInput.value.trim();

		if (newComment !== '') {
			// Create new comment section
			var newCommentSection = document.createElement('div');
			newCommentSection.className = 'commented-section mt-2';

			// Create commented user section with fixed username
			var commentedUser = document.createElement('div');
			commentedUser.className = 'd-flex flex-row align-items-center commented-user';
			var userName = document.createElement('h5');
			userName.className = 'mr-2';
			userName.textContent = "AnonUser123";
			commentedUser.appendChild(userName);
			newCommentSection.appendChild(commentedUser);

			// Create comment text section
			var commentText = document.createElement('div');
			commentText.className = 'comment-text-sm';
			var commentSpan = document.createElement('span');
			commentSpan.textContent = newComment;
			commentText.appendChild(commentSpan);
			newCommentSection.appendChild(commentText);

			// Insert new comment section at the beginning
			var existingComments = document.querySelector('.coment-bottom').children;
			if (existingComments.length > 1) {
				document.querySelector('.coment-bottom').insertBefore(newCommentSection, existingComments[1]);
			} else {
				document.querySelector('.coment-bottom').appendChild(newCommentSection);
			}

			// Create and insert horizontal rule below the new comment content
			var newHR = document.createElement('hr');
			document.querySelector('.coment-bottom').insertBefore(newHR, newCommentSection.nextSibling);

			// Call the function to add buttons to the comment section
			addButtonsToComment(newCommentSection, newComment);

			// Clear the input field
			commentInput.value = '';
		}
	}


</script>

<script type="text/javascript">
	var commentInput = document.getElementById('commentInput');

	// Add an event listener for the Enter key on the input field
	commentInput.addEventListener('keydown', function (event) {
		if (event.key === 'Enter') {
			event.preventDefault(); // Prevent the default behavior of Enter key (e.g., adding a new line)
			submitComment()
		}
	});


	document.getElementById('commentButton').addEventListener('click', function () {
		submitComment()
	});

	// Event delegation to handle delete button click, view button click, and simulated blurred comment buttons
	document.querySelector('.coment-bottom').addEventListener('click', function (event) {
		var commentSection = event.target.closest('.commented-section');

		if (!commentSection) {
			// If the clicked element is not inside a comment section, exit the function
			return;
		}

		var textElement = commentSection.querySelector('.comment-text-sm');
		var buttonElement = commentSection.querySelector('.toggle-button');

		if (event.target.classList.contains('delete-button')) {
			// Delete the comment section when the delete button is clicked
			commentSection.parentNode.removeChild(commentSection);

			// Get the next sibling (which is the HR element)
			var nextElement = commentSection.nextElementSibling;
			console.log(nextElement)
			// Check if the next sibling is an HR element (case-insensitive check)
			if (nextElement && nextElement.tagName.toUpperCase() === 'HR') {
				nextElement.parentNode.removeChild(nextElement);
			}
		}
		else if (event.target.classList.contains('toggle-button')) {
			// Toggle the blur class on the text element
			textElement.classList.toggle('blur');
			// Update the button text based on the current state
			buttonElement.textContent = textElement.classList.contains('blur') ? 'View' : 'Hide';
		}
	});

</script>


</html>